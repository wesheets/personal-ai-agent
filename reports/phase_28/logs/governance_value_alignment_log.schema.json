{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "GovernanceValueAlignmentLogEntry",
  "description": "Schema for an entry in the governance_value_alignment_log.json file, recording the alignment of loop decisions with governance values.",
  "type": "object",
  "properties": {
    "log_entry_id": {
      "description": "Unique identifier for this log entry.",
      "type": "string",
      "format": "uuid"
    },
    "loop_id": {
      "description": "The identifier of the loop being reconciled.",
      "type": "string"
    },
    "decision_point": {
      "description": "Specifies what part of the loop is being reconciled (e.g., plan_selection, plan_rejection, plan_evaluation).",
      "type": "string"
    },
    "reconciliation_timestamp_utc": {
      "description": "UTC timestamp of when this reconciliation entry was created (ISO 8601 format).",
      "type": "string",
      "format": "date-time"
    },
    "alignment_score": {
      "description": "A numerical score (e.g., 0.0 to 1.0) or a categorical assessment (e.g., 'aligned', 'partially_aligned', 'misaligned') indicating the overall degree of alignment for this decision point.",
      "type": ["number", "string"]
    },
    "misalignments": {
      "description": "An array of objects detailing specific misalignments found.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "misalignment_id": {
            "description": "Unique identifier for this specific misalignment instance.",
            "type": "string",
            "format": "uuid"
          },
          "governance_surface_type": {
            "description": "The type of governance surface where misalignment was detected.",
            "type": "string",
            "enum": ["emotion_state", "emotion_profile", "invariants", "trust_score", "belief_weights"]
          },
          "governance_surface_detail": {
            "description": "Specific detail about the governance surface (e.g., invariant ID, emotion dimension).",
            "type": "string"
          },
          "expected_value_or_behavior": {
            "description": "What the governance surface implied or required.",
            "type": ["string", "number", "boolean", "object", "array", "null"]
          },
          "actual_value_or_behavior": {
            "description": "What was observed in the loop decision or agent state.",
            "type": ["string", "number", "boolean", "object", "array", "null"]
          },
          "discrepancy_description": {
            "description": "A human-readable description of the misalignment.",
            "type": "string"
          },
          "severity": {
            "description": "Assessed severity of the misalignment.",
            "type": "string",
            "enum": ["low", "medium", "high", "critical", "informational"]
          }
        },
        "required": [
          "misalignment_id",
          "governance_surface_type",
          "expected_value_or_behavior",
          "actual_value_or_behavior",
          "discrepancy_description"
        ]
      }
    },
    "governance_context_snapshot": {
      "description": "A snapshot of relevant governance values and inputs at the time of the original loop decision (or as best as can be reconstructed/simulated).",
      "type": "object",
      "properties": {
        "original_loop_timestamp_utc": {
          "description": "The timestamp of the original loop event, if available.",
          "type": ["string", "null"],
          "format": "date-time"
        },
        "agent_emotion_state": {
          "description": "Snapshot of agent_emotion_state.json content relevant to the loop.",
          "type": ["object", "null"]
        },
        "agent_emotion_profile": {
          "description": "Snapshot of agent_emotion_profile.json content relevant to the loop.",
          "type": ["object", "null"]
        },
        "promethios_invariants": {
          "description": "Snapshot of promethios_invariants.json content or relevant active invariants.",
          "type": ["object", "array", "null"]
        },
        "trust_score_inputs_and_outputs": {
          "description": "Inputs used for trust scoring and the resulting scores/evaluations for the loop.",
          "type": ["object", "null"]
        },
        "belief_weight_index": {
          "description": "Snapshot of belief_weight_index.json content or relevant belief weights.",
          "type": ["object", "null"]
        },
        "data_source_notes": {
            "description": "Notes on the source or simulation of the context data (e.g., 'actual_log', 'simulated_due_to_missing_state_log', 'current_value_used').",
            "type": "string"
        }
      }
    },
    "processed_plan_details": {
        "description": "Details of the plan(s) being reconciled for this loop decision.",
        "type": ["object", "array", "null"]
    }
  },
  "required": [
    "log_entry_id",
    "loop_id",
    "decision_point",
    "reconciliation_timestamp_utc",
    "alignment_score",
    "misalignments",
    "governance_context_snapshot"
  ]
}

