{
  "$schema": "http:
  "title": "HTML Export Format Schema",
  "description": "Schema for loop lineage export in HTML format",
  "type": "object",
  "required": ["success", "loop_id", "format", "file_path"],
  "properties": {
    "success": {
      "type": "boolean",
      "description": "Whether the export was successful"
    },
    "loop_id": {
      "type": "string",
      "description": "ID of the loop that was exported",
      "pattern": "^loop_[0-9a-zA-Z]+$"
    },
    "format": {
      "type": "string",
      "description": "Export format",
      "enum": ["html"]
    },
    "file_path": {
      "type": "string",
      "description": "Path to the exported file"
    },
    "content_structure": {
      "type": "object",
      "description": "Structure of the HTML content",
      "required": ["doctype", "head", "body"],
      "properties": {
        "doctype": {
          "type": "string",
          "description": "HTML doctype declaration",
          "enum": ["<!DOCTYPE html>"]
        },
        "head": {
          "type": "object",
          "description": "Head section of the HTML document",
          "required": ["title", "meta", "style"],
          "properties": {
            "title": {
              "type": "string",
              "description": "Title of the document"
            },
            "meta": {
              "type": "array",
              "description": "Meta tags in the document",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Name attribute of the meta tag"
                  },
                  "content": {
                    "type": "string",
                    "description": "Content attribute of the meta tag"
                  }
                }
              }
            },
            "style": {
              "type": "string",
              "description": "CSS styles for the document"
            }
          }
        },
        "body": {
          "type": "object",
          "description": "Body section of the HTML document",
          "required": ["header", "summary", "lineage", "details", "safety"],
          "properties": {
            "header": {
              "type": "object",
              "description": "Header section of the HTML document",
              "required": ["title", "timestamp", "loop_id"],
              "properties": {
                "title": {
                  "type": "string",
                  "description": "Title of the document"
                },
                "timestamp": {
                  "type": "string",
                  "description": "ISO 8601 timestamp of when the export was created",
                  "format": "date-time"
                },
                "loop_id": {
                  "type": "string",
                  "description": "ID of the loop",
                  "pattern": "^loop_[0-9a-zA-Z]+$"
                }
              }
            },
            "summary": {
              "type": "object",
              "description": "Summary section of the HTML document",
              "required": ["content", "alignment_score", "drift_score"],
              "properties": {
                "content": {
                  "type": "string",
                  "description": "Summary text"
                },
                "alignment_score": {
                  "type": "number",
                  "description": "Alignment score (0.0 to 1.0)",
                  "minimum": 0.0,
                  "maximum": 1.0
                },
                "drift_score": {
                  "type": "number",
                  "description": "Drift score (0.0 to 1.0)",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "lineage": {
              "type": "object",
              "description": "Lineage section of the HTML document",
              "required": ["parent", "children", "siblings"],
              "properties": {
                "parent": {
                  "type": ["string", "null"],
                  "description": "ID of the parent loop, or null if no parent"
                },
                "children": {
                  "type": "array",
                  "description": "IDs of child loops",
                  "items": {
                    "type": "string",
                    "pattern": "^loop_[0-9a-zA-Z]+$"
                  }
                },
                "siblings": {
                  "type": "array",
                  "description": "IDs of sibling loops",
                  "items": {
                    "type": "string",
                    "pattern": "^loop_[0-9a-zA-Z]+$"
                  }
                }
              }
            },
            "details": {
              "type": "object",
              "description": "Details section of the HTML document",
              "required": ["status", "rerun_count", "orchestrator_persona"],
              "properties": {
                "status": {
                  "type": "string",
                  "description": "Status of the loop",
                  "enum": ["pending", "running", "completed", "finalized", "failed"]
                },
                "rerun_count": {
                  "type": "integer",
                  "description": "Number of times the loop has been rerun",
                  "minimum": 0
                },
                "orchestrator_persona": {
                  "type": "string",
                  "description": "Persona of the orchestrator"
                }
              }
            },
            "safety": {
              "type": "object",
              "description": "Safety section of the HTML document",
              "required": ["checks_performed", "warnings_issued"],
              "properties": {
                "checks_performed": {
                  "type": "array",
                  "description": "Safety checks that were performed",
                  "items": {
                    "type": "string"
                  }
                },
                "warnings_issued": {
                  "type": "array",
                  "description": "Safety warnings that were issued",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "visualization": {
              "type": "object",
              "description": "Visualization section of the HTML document (HTML-specific)",
              "properties": {
                "interactive_elements": {
                  "type": "boolean",
                  "description": "Whether the document contains interactive elements"
                },
                "css_classes": {
                  "type": "array",
                  "description": "CSS classes used in the document",
                  "items": {
                    "type": "string"
                  }
                },
                "js_modules": {
                  "type": "array",
                  "description": "JavaScript modules used in the document",
                  "items": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Metadata about the export",
      "properties": {
        "export_timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp of when the export was created",
          "format": "date-time"
        },
        "export_version": {
          "type": "string",
          "description": "Version of the export format"
        },
        "schema_validated": {
          "type": "boolean",
          "description": "Whether the export was validated against the schema"
        },
        "browser_compatibility": {
          "type": "array",
          "description": "Browsers compatible with this HTML export",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
