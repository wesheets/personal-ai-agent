{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Markdown Export Format Schema",
  "description": "Schema for loop lineage export in Markdown format",
  "type": "object",
  "required": ["success", "loop_id", "format", "file_path"],
  "properties": {
    "success": {
      "type": "boolean",
      "description": "Whether the export was successful"
    },
    "loop_id": {
      "type": "string",
      "description": "ID of the loop that was exported",
      "pattern": "^loop_[0-9a-zA-Z]+$"
    },
    "format": {
      "type": "string",
      "description": "Export format",
      "enum": ["md"]
    },
    "file_path": {
      "type": "string",
      "description": "Path to the exported file"
    },
    "content_structure": {
      "type": "object",
      "description": "Structure of the Markdown content",
      "required": ["header", "summary", "lineage", "details", "safety"],
      "properties": {
        "header": {
          "type": "object",
          "description": "Header section of the Markdown document",
          "required": ["title", "timestamp", "loop_id"],
          "properties": {
            "title": {
              "type": "string",
              "description": "Title of the document"
            },
            "timestamp": {
              "type": "string",
              "description": "ISO 8601 timestamp of when the export was created",
              "format": "date-time"
            },
            "loop_id": {
              "type": "string",
              "description": "ID of the loop",
              "pattern": "^loop_[0-9a-zA-Z]+$"
            }
          }
        },
        "summary": {
          "type": "object",
          "description": "Summary section of the Markdown document",
          "required": ["content", "alignment_score", "drift_score"],
          "properties": {
            "content": {
              "type": "string",
              "description": "Summary text"
            },
            "alignment_score": {
              "type": "number",
              "description": "Alignment score (0.0 to 1.0)",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "drift_score": {
              "type": "number",
              "description": "Drift score (0.0 to 1.0)",
              "minimum": 0.0,
              "maximum": 1.0
            }
          }
        },
        "lineage": {
          "type": "object",
          "description": "Lineage section of the Markdown document",
          "required": ["parent", "children", "siblings"],
          "properties": {
            "parent": {
              "type": ["string", "null"],
              "description": "ID of the parent loop, or null if no parent"
            },
            "children": {
              "type": "array",
              "description": "IDs of child loops",
              "items": {
                "type": "string",
                "pattern": "^loop_[0-9a-zA-Z]+$"
              }
            },
            "siblings": {
              "type": "array",
              "description": "IDs of sibling loops",
              "items": {
                "type": "string",
                "pattern": "^loop_[0-9a-zA-Z]+$"
              }
            }
          }
        },
        "details": {
          "type": "object",
          "description": "Details section of the Markdown document",
          "required": ["status", "rerun_count", "orchestrator_persona"],
          "properties": {
            "status": {
              "type": "string",
              "description": "Status of the loop",
              "enum": ["pending", "running", "completed", "finalized", "failed"]
            },
            "rerun_count": {
              "type": "integer",
              "description": "Number of times the loop has been rerun",
              "minimum": 0
            },
            "orchestrator_persona": {
              "type": "string",
              "description": "Persona of the orchestrator"
            }
          }
        },
        "safety": {
          "type": "object",
          "description": "Safety section of the Markdown document",
          "required": ["checks_performed", "warnings_issued"],
          "properties": {
            "checks_performed": {
              "type": "array",
              "description": "Safety checks that were performed",
              "items": {
                "type": "string"
              }
            },
            "warnings_issued": {
              "type": "array",
              "description": "Safety warnings that were issued",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Metadata about the export",
      "properties": {
        "export_timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp of when the export was created",
          "format": "date-time"
        },
        "export_version": {
          "type": "string",
          "description": "Version of the export format"
        },
        "schema_validated": {
          "type": "boolean",
          "description": "Whether the export was validated against the schema"
        }
      }
    }
  }
}
