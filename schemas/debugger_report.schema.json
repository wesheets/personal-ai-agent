{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Debugger Report Schema",
  "description": "Schema for reports generated by the Debugger Agent when analyzing loop failures",
  "type": "object",
  "required": [
    "loop_id",
    "failure_type",
    "suggested_fix",
    "timestamp",
    "next_agent"
  ],
  "properties": {
    "loop_id": {
      "type": "string",
      "description": "Identifier for the failed loop"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when the report was generated",
      "format": "date-time"
    },
    "failure_type": {
      "type": "string",
      "description": "Type of failure that occurred",
      "enum": [
        "tool_timeout",
        "api_rate_limit",
        "permission_error",
        "resource_not_found",
        "invalid_input",
        "memory_error",
        "network_error",
        "dependency_error",
        "unknown"
      ]
    },
    "details": {
      "type": "object",
      "description": "Detailed information about the failure",
      "properties": {
        "error_message": {
          "type": "string",
          "description": "Specific error message extracted from the logs"
        },
        "line_number": {
          "type": "integer",
          "description": "Line number where the error occurred"
        },
        "file_name": {
          "type": "string",
          "description": "File where the error occurred"
        },
        "suggested_fix": {
          "type": "string",
          "description": "Specific suggestion to fix the issue"
        }
      }
    },
    "suggested_fix": {
      "type": "string",
      "description": "Human-readable suggestion for fixing the issue"
    },
    "patch_plan": {
      "type": "object",
      "description": "Plan for patching the failure",
      "properties": {
        "steps": {
          "type": "array",
          "description": "Steps to take to fix the issue",
          "items": {
            "type": "string"
          }
        },
        "confidence": {
          "type": "number",
          "description": "Confidence in the patch plan",
          "minimum": 0,
          "maximum": 1
        }
      },
      "required": ["steps"]
    },
    "next_agent": {
      "type": "string",
      "description": "Agent that should handle the failure next",
      "enum": [
        "optimizer",
        "scheduler",
        "security",
        "researcher",
        "validator",
        "connector",
        "installer",
        "critic"
      ]
    },
    "severity": {
      "type": "string",
      "description": "Severity of the failure",
      "enum": [
        "low",
        "medium",
        "high",
        "critical"
      ]
    }
  },
  "additionalProperties": false
}
