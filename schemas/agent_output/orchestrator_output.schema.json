{
  "$schema": "http:
  "title": "Orchestrator Agent Output Schema",
  "description": "Schema for outputs generated by the Orchestrator Agent when performing orchestration operations",
  "type": "object",
  "required": [
    "status",
    "task",
    "project_id",
    "intent",
    "action",
    "timestamp",
    "output"
  ],
  "properties": {
    "status": {
      "type": "string",
      "description": "Status of the orchestration operation",
      "enum": [
        "success",
        "error",
        "partial"
      ]
    },
    "task": {
      "type": "string",
      "description": "Original task requested by the user"
    },
    "project_id": {
      "type": "string",
      "description": "Project identifier associated with the orchestration operation"
    },
    "intent": {
      "type": "string",
      "description": "High-level intent of the orchestration operation",
      "enum": [
        "orchestration",
        "delegation",
        "monitoring",
        "coordination",
        "error_handling"
      ]
    },
    "action": {
      "type": "string",
      "description": "Specific action performed by the orchestrator",
      "enum": [
        "initialize",
        "complete_agent",
        "get_decisions",
        "get_last_decision",
        "visualize_decisions",
        "trigger_next_agent",
        "unknown",
        "error"
      ]
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when the operation was performed"
    },
    "output": {
      "type": "string",
      "description": "Human-readable output of the orchestration operation"
    },
    "error": {
      "type": "string",
      "description": "Error message if operation failed"
    },
    "tools": {
      "type": "array",
      "description": "List of tools used in the operation",
      "items": {
        "type": "string"
      }
    },
    "loop_id": {
      "type": "string",
      "description": "Identifier for the current execution loop"
    },
    "next_agent": {
      "type": "string",
      "description": "Name of the next agent to be triggered"
    },
    "completed_agent": {
      "type": "string",
      "description": "Name of the agent that was marked as completed"
    },
    "trigger_result": {
      "type": "object",
      "description": "Result of triggering the next agent",
      "properties": {
        "triggered_agent": {
          "type": "string",
          "description": "Name of the agent that was triggered"
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp when the agent was triggered"
        },
        "loop_count": {
          "type": "integer",
          "description": "Current loop count"
        },
        "reason": {
          "type": "string",
          "description": "Reason for triggering this agent"
        },
        "status": {
          "type": "string",
          "description": "Status of the trigger operation",
          "enum": [
            "triggered",
            "failed",
            "pending"
          ]
        }
      },
      "required": [
        "triggered_agent",
        "timestamp",
        "status"
      ]
    },
    "reason": {
      "type": "string",
      "description": "Reason for the orchestration decision"
    },
    "all_loops_complete": {
      "type": "boolean",
      "description": "Whether all execution loops are complete"
    },
    "decisions": {
      "type": "array",
      "description": "List of orchestration decisions",
      "items": {
        "type": "object",
        "properties": {
          "timestamp": {
            "type": "string",
            "description": "ISO 8601 timestamp when the decision was made"
          },
          "loop_count": {
            "type": "integer",
            "description": "Loop count when the decision was made"
          },
          "last_agent": {
            "type": ["string", "null"],
            "description": "Name of the last agent that ran"
          },
          "next_agent": {
            "type": ["string", "null"],
            "description": "Name of the next agent to run"
          },
          "reason": {
            "type": "string",
            "description": "Reason for the decision"
          }
        },
        "required": [
          "timestamp",
          "loop_count",
          "next_agent",
          "reason"
        ]
      }
    },
    "decision": {
      "type": "object",
      "description": "Single orchestration decision",
      "properties": {
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp when the decision was made"
        },
        "loop_count": {
          "type": "integer",
          "description": "Loop count when the decision was made"
        },
        "last_agent": {
          "type": ["string", "null"],
          "description": "Name of the last agent that ran"
        },
        "next_agent": {
          "type": ["string", "null"],
          "description": "Name of the next agent to run"
        },
        "reason": {
          "type": "string",
          "description": "Reason for the decision"
        }
      },
      "required": [
        "timestamp",
        "loop_count",
        "next_agent",
        "reason"
      ]
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "status": { "enum": ["error"] }
        }
      },
      "then": {
        "required": ["error"]
      }
    },
    {
      "if": {
        "properties": {
          "action": { "enum": ["initialize"] }
        }
      },
      "then": {
        "required": ["loop_id", "next_agent", "trigger_result"]
      }
    },
    {
      "if": {
        "properties": {
          "action": { "enum": ["complete_agent"] }
        }
      },
      "then": {
        "required": ["completed_agent"]
      }
    },
    {
      "if": {
        "properties": {
          "action": { "enum": ["get_decisions"] }
        }
      },
      "then": {
        "required": ["decisions"]
      }
    },
    {
      "if": {
        "properties": {
          "action": { "enum": ["get_last_decision"] }
        }
      },
      "then": {
        "required": ["decision"]
      }
    },
    {
      "if": {
        "properties": {
          "action": { "enum": ["visualize_decisions"] }
        }
      },
      "then": {
        "required": ["decisions"]
      }
    },
    {
      "if": {
        "properties": {
          "action": { "enum": ["trigger_next_agent"] }
        }
      },
      "then": {
        "required": ["trigger_result"]
      }
    }
  ]
}
