{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HAL Agent Safety Check Schema",
  "description": "Schema for safety check outputs generated by the HAL Agent",
  "type": "object",
  "required": [
    "status",
    "task",
    "project_id",
    "timestamp",
    "safety_checks",
    "constraints_validated"
  ],
  "properties": {
    "status": {
      "type": "string",
      "description": "Status of the HAL operation",
      "enum": [
        "success",
        "error",
        "partial"
      ]
    },
    "task": {
      "type": "string",
      "description": "Original task requested by the user"
    },
    "project_id": {
      "type": "string",
      "description": "Project identifier associated with the HAL operation"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp when the operation was performed"
    },
    "safety_checks": {
      "type": "array",
      "description": "List of safety checks performed",
      "items": {
        "type": "object",
        "required": [
          "check_name",
          "check_type",
          "timestamp",
          "status",
          "message"
        ],
        "properties": {
          "check_name": {
            "type": "string",
            "description": "Name of the safety check"
          },
          "check_type": {
            "type": "string",
            "description": "Type of safety check",
            "enum": [
              "content",
              "permission",
              "resource",
              "security",
              "compliance",
              "integrity"
            ]
          },
          "timestamp": {
            "type": "string",
            "description": "ISO 8601 timestamp when the check was performed"
          },
          "status": {
            "type": "string",
            "description": "Status of the safety check",
            "enum": [
              "passed",
              "failed",
              "warning",
              "skipped"
            ]
          },
          "message": {
            "type": "string",
            "description": "Message describing the result of the safety check"
          },
          "details": {
            "type": "object",
            "description": "Additional details about the safety check"
          }
        }
      }
    },
    "constraints_validated": {
      "type": "boolean",
      "description": "Whether all constraints were validated successfully"
    },
    "message": {
      "type": "string",
      "description": "Human-readable message describing the HAL operation result"
    },
    "error": {
      "type": "string",
      "description": "Error message if operation failed"
    },
    "output": {
      "type": "string",
      "description": "Human-readable output of the HAL operation"
    },
    "tools": {
      "type": "array",
      "description": "List of tools used in the operation",
      "items": {
        "type": "string"
      }
    },
    "files_created": {
      "type": "array",
      "description": "List of files created by the HAL operation",
      "items": {
        "type": "string"
      }
    },
    "next_recommended_step": {
      "type": "string",
      "description": "Recommended next step after the HAL operation"
    },
    "memory_warning": {
      "type": "string",
      "description": "Warning message related to memory operations"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "status": { "enum": ["error"] }
        }
      },
      "then": {
        "required": ["error"]
      }
    },
    {
      "if": {
        "properties": {
          "constraints_validated": { "enum": [true] }
        }
      },
      "then": {
        "required": ["output"]
      }
    },
    {
      "if": {
        "properties": {
          "constraints_validated": { "enum": [true] }
        }
      },
      "then": {
        "required": ["files_created", "next_recommended_step"]
      }
    }
  ]
}
